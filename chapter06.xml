<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter SYSTEM "core.dtd">
<chapter name="Язык Objective Caml" number="6">
	<main-matters>
	<section name="Введение">
		<para>Эта глава является справочником по языку Objective Caml. Она перечисляет языковые конструкции и дает
		их точный синтаксис и неформальную семантику. Она никоим образом не может считаться учебником, и в ней нет ни
		одного примера кода. Ожидается, что читатель хорошо знает Caml.</para>
		<para>
			Нет здесь и математической точности. Слова употребляются в их обычном значении. Соотвественно, правила
			оформления также не соблюдаются в силу отсутсвия математеского аппарата, необходимого для их 
			формулировки. Тем не менее, они, разумеется, являются частью полного формального определения языка.
		</para>
		<subsection name="Нотация" neednumber="0">
			<para>
				Синтаксис языка приведен в нотации, напоминающей BNF. Терминальные символы обозначаются
				<value>таким образом</value>. Нетерминальные символы <term>оформлены так</term>. В квадратных
				скобках ([...]) перечислены необязательные элементы. Фигурные скобки ({...}) обозначают ноль и
				более повторяющихся компонентов. Если фигурные скобки сопровождаются знаком плюса ({...}<sub>+</sub>),
				то это означает, что компонент повторяется один и более раз. Круглые скобки ((...)) означают группировку.
			</para>
		</subsection>
	</section>
	<section name="Лексические соглашения">
		<subsection name="Пробельные символы" neednumber="0">
			<para>
				Пробельными символами считаются: пробел, символ новой строки, горизонтальная табуляция, перевод строки,
				возврат каретки, подача страницы. Они игнорируются, но используются для разделения идентификаторов, 
				литералов и ключевых слов, которые в противном случае считались бы одним идентификатором, литералом
				или ключевым словом.
			</para>
		</subsection>
		<subsection name="Комментарии" neednumber="0">
			<para>Комментарии начинаются начинаются знаками (* без пробела между ними и заканчиваются знаками *)
				без пробела между ними. Они считаются пробельными символами и не могут находится внутри строки или 
				символьного литерала. Вложенные комментарии обрабатываются правильно.
			</para>
		</subsection>
		<subsection name="Идентификаторы" neednumber="0">
			<bnf>
				<term>ident</term>
				<def>
					<group>
						<or multiline="0">
							<choice><term>letter</term></choice>
							<choice><value>...</value></choice>
						</or>
					</group>
					<repetitive>
						<or>
							<choice><term>letter</term></choice>
							<choice><value>0...9</value></choice>
							<choice><value>_</value></choice>
							<choice><value>&apos;</value></choice>
						</or>
					</repetitive>
				</def>
			</bnf>
			<bnf>
				<term>letter</term>
				<def>
					<or multiline="0"><choice><value>A...Z</value></choice><choice><value>a...z</value></choice></or>
				</def>
			</bnf>
			<para>Идентификаторы состоят из последовательности букв, цифр, _ (символов подчеркивания), &apos; (одинарных
			кавычек), начинающейся с буквы или символа подчеркивания. Буквы включают по крайней мере пятьдесят два
			символа из набора ASCII в верхнем и нижнем регистрах. Текущая реализация (за исключением платформы MacOS)
			допускает также симоволы с акцентами из ISO 9959-1 (или ISO Latin 1). Значимы все символы в идентификаторе, и
			в текущей реализации его длина не ограничивается.
			</para>
		</subsection>
		<subsection name="Целочисленные литералы" neednumber="0">
			<bnf>
				<term>integer-literal</term>
				<def>
					<or multiline="1">
						<choice>
							<optional><value>-</value></optional>
							<repetitive count="1"><value>0..9</value></repetitive>
						</choice>
						<choice>
							<optional><value>-</value></optional>
							<group>
								<or multiline="0"><choice><value>0x</value></choice><choice><value>0X</value></choice></or>
							</group>
								<repetitive count="1">
									<or multiline="0">
										<choice><value>0...9</value></choice>
										<choice><value>A...F</value></choice>
										<choice><value>a..f</value></choice>
									</or>
								</repetitive>
						</choice>
						<choice>
							<optional><value>-</value></optional>
							<group>
								<or multiline="0"><choice><value>0o</value></choice><choice><value>0O</value></choice></or>
							</group>
								<repetitive count="1">
										<value>0...7</value>
								</repetitive>
						</choice>
						<choice>
							<optional><value>-</value></optional>
							<group>
								<or multiline="0"><choice><value>0b</value></choice><choice><value>0B</value></choice></or>
							</group>
								<repetitive count="1">
										<value>0...1</value>
								</repetitive>
						</choice>
					</or>
				</def>
			</bnf>
			<para>Целочисленный литерал - это последовательность из одной или нескольких цифр, которой может
			предшествовать знак минус. По умолчанию целочисленные литералы считаются десятичными (основание 10).
			Основание изменяется следующими префиксами:</para>
			<table>
				<thead>
					<trow>
						<tcell>Префикс</tcell>
						<tcell>Основание</tcell>
					</trow>
				</thead>
				<tbody>
					<trow>
						<tcell><para><keyword>0x, 0X</keyword></para></tcell>
						<tcell><para>шестнадцатиричное (основание 16)</para></tcell>
					</trow>
					<trow>
						<tcell><para><keyword>0o, 0O</keyword></para></tcell>
						<tcell><para>восьмеричное (основание 8)</para></tcell>
					</trow>
					<trow>
						<tcell><para><keyword>0b, 0B</keyword></para></tcell>
						<tcell><para>двоичное (основание 2)</para></tcell>
					</trow>
				</tbody>
			</table>
			<para>
				(Первое <keyword>0</keyword> - цифра ноль, второе <keyword>o</keyword> для двоичных чисел - буква
				 &quot;O&quot;). Интерпретация целочисленных литералов, не попадающих в приемлемый диапазон
				 значений для целого числа, не определена.
			</para>
		</subsection>
		<subsection name="Литералы для чисел с плавающей точкой" neednumber="0">
			<bnf>
				<term>float-literal</term>
				<def>
					<optional><value>-</value></optional>
					<repetitive count="1"><value>0...9</value></repetitive>
					<optional>
						<value>.</value>
						<repetitive>
							<value>0...9</value>
						</repetitive>
					</optional>
					<optional>
						<group>
							<or multiline="0">
								<choice>
									<value>e</value>
								</choice>
								<choice>
									<value>E</value>
								</choice>
							</or>
						</group>
						<optional>
							<or>
								<choice><value>+</value></choice>
								<choice><value>-</value></choice>
							</or>
						</optional>
						<repetitive count="1">
							<value>0...9</value>
						</repetitive>
					</optional>
				</def>
			</bnf>
			<para>Литералы для чисел с плавающей точкой состоят из трех частей - целочисленной, десятичной
			и экспоненты. Целочисленная часть - это последовательность из одной или нескольких цифр
			с необязательным знаком плюс или минус. Десятичная - точка, за которой следуют ноль или более цифр.
			Экспонента - буква <keyword>e</keyword> или <keyword>E</keyword>, необязательный знак плюс или
			минус и одна или более цифр. Десятичная часть или экспонента могут быть опущены, однако лучше, чтобы
			присутствовала хоть одна из них, чтобы число отличалось от целочисленных литералов. Интерпретация литералов
			для чисел с плавающей точкой, не попадающих в приемлемый диапазон, не определена.</para>
		</subsection>
		<subsection name="Символьные литералы" neednumber="0">
			<bnf>
				<term>char-literal</term>
				<def>
					<or multiline="1">
						<choice><value>'</value><term>regular-char</term><value>'</value></choice>
						<choice><value>'</value><term>escape-sequence</term><value>'</value></choice>
					</or>
				</def>
			</bnf>
			<bnf>
				<term>escape-sequence</term>
				<def>
					<or multiline="1">
						<choice>
							<value>\</value>
							<group>
								<or multiline="0">
									<choice><value>\</value></choice>
									<choice><value>"</value></choice>
									<choice><value>'</value></choice>
									<choice><value>n</value></choice>
									<choice><value>t</value></choice>
									<choice><value>b</value></choice>
									<choice><value>r</value></choice>
								</or>
							</group>
						</choice>
						<choice>
							<value>\</value>
							<group><value>0...9</value></group>
							<group><value>0...9</value></group>
							<group><value>0...9</value></group>
						</choice>
					</or>
				</def>
			</bnf>
			<para>Символьные литералы ограничиваются одинарными кавычками (<keyword>&apos;</keyword>). Две
			одинарные кавычки могут ограничивать либо один символ, отличный от &apos; и \, либо одну из управляющих
			последовательностей ниже:</para>
			<table>
				<thead>
					<trow>
						<tcell><para>Последовательность</para></tcell>
						<tcell><para>Обозначаемый символ</para></tcell>
					</trow>
				</thead>
				<tbody>
					<trow>
						<tcell><para><keyword>\\</keyword></para></tcell>
						<tcell><para>Обратная косая черта (\)</para></tcell>
					</trow>
					<trow>
						<tcell><para><keyword>\&quot;</keyword></para></tcell>
						<tcell><para>Двойная кавычка (&quot;)</para></tcell>
					</trow>
					<trow>
						<tcell><para><keyword>\&apos;</keyword></para></tcell>
						<tcell><para>Одинарная кавычка (&apos;)</para></tcell>
					</trow>
					<trow>
						<tcell><para><keyword>\n</keyword></para></tcell>
						<tcell><para>Перевод строки (LF)</para></tcell>
					</trow>
					<trow>
						<tcell><para><keyword>\r</keyword></para></tcell>
						<tcell><para>Возврат каретки (CR)</para></tcell>
					</trow>
					<trow>
						<tcell><para><keyword>\t</keyword></para></tcell>
						<tcell><para>Горизонтальная табуляция (TAB)</para></tcell>
					</trow>
					<trow>
						<tcell><para><keyword>\b</keyword></para></tcell>
						<tcell><para>Забой (BS)</para></tcell>
					</trow>
					<trow>
						<tcell><para><keyword>\ddd</keyword></para></tcell>
						<tcell><para>Символ с десятичным кодом ASCII <keyword>ddd</keyword></para></tcell>
					</trow>
				</tbody>
			</table>
		</subsection>
		<subsection name="Строковые литералы" neednumber="0">
			<bnf>
				<term>string-literal</term>
				<def>
					<value>&quot;</value>
					<repetitive><term>string-character</term></repetitive>
					<value>&quot;</value>
				</def>
			</bnf>
			<bnf>
				<term>string-character</term>
				<def>
					<or multiline="1">
						<choice>
							<term>regular-char</term>
						</choice>
						<choice>
							<term>escape-sequence</term>
						</choice>
					</or>
				</def>
			</bnf>
			<para>
				Строковые литералы ограничиваются двойными кавычками (<keyword>&quot;</keyword>). 
				Двойные кавычки могут ограничивать либо один символ, отличный от &apos; и \, либо одну из управляющих
			последовательностей из таблицы выше.
			</para>
			<para>
				Чтобы длинные строковые литералы можно было разбивать на несколько строк,
				последовательность <term>\newline blanks</term> (обратная косая черта внутри строки,
				за которой следует произвольное число пробельных символов
				в начале следующей строки) игнорируется.
			</para>
			<para>В текущей реализации длина строковых литералов практически не ограничена</para>
		</subsection>
		<subsection name="Именованные метки" neednumber="0">
			<para>
				Во избежание двусмысленностей именованные метки нельзя просто определить синтаксически
				как последовательность трех токенов <value>~</value>, <term>ident</term> и <keyword>:</keyword>.
				Они требуют определения на лексическом уровне.
			</para>
			<bnf>
				<term>label</term>
				<def>
					<value>~</value>
					<group><value>a...z</value></group>
					<repetitive count="1">
						<or multiline="0">
							<choice><term>letter</term></choice>
							<choice><value>0...9</value></choice>
							<choice><value>_</value></choice>
							<choice><value>&apos;</value></choice>
						</or>
					</repetitive>
					<value>:</value>
				</def>
			</bnf>
			<bnf>
				<term>oplabel</term>
				<def>
					<value>?</value>
					<group><value>a...z</value></group>
					<repetitive count="1">
						<or multiline="0">
							<choice><term>letter</term></choice>
							<choice><value>0...9</value></choice>
							<choice><value>_</value></choice>
							<choice><value>&apos;</value></choice>
						</or>
					</repetitive>
					<value>:</value>
				</def>
			</bnf>
			<para>
				Именованные метки бывают двух видов: <term>label</term> для обычных аргументов
				и <term>optlabel</term> для необязательных. Они отличаются только первым символом
				- <keyword>~</keyword> или <keyword>?</keyword>.
			</para>
		</subsection>
		<subsection name="Префиксные и инфиксные символы" neednumber="0">
			<bnf>
				<term>infix-symbol</term>
				<def>
					<group>
						<or multiline="0">
							<choice><value>=</value></choice>
							<choice><value>&lt;</value></choice>
							<choice><value>&gt;</value></choice>
							<choice><value>@</value></choice>
							<choice><value>^</value></choice>
							<choice><value>|</value></choice>
							<choice><value>&amp;</value></choice>
							<choice><value>+</value></choice>
							<choice><value>-</value></choice>
							<choice><value>*</value></choice>
							<choice><value>/</value></choice>
							<choice><value>$</value></choice>
							<choice><value>%</value></choice>
						</or>
					</group>
					<repetitive><term>operator-char</term></repetitive>
				</def>
			</bnf>
			<bnf>
				<term>prefix-symbol</term>
				<def>
					<group>
						<or multiline="0">
							<choice><value>~</value></choice>
							<choice><value>!</value></choice>
							<choice><value>?</value></choice>
						</or>
					</group>
					<repetitive><term>operator-char</term></repetitive>
				</def>
			</bnf>
			<bnf>
				<term>operator-char</term>
				<def>
						<or multiline="0">
							<choice><value>!</value></choice>
							<choice><value>:</value></choice>
							<choice><value>.</value></choice>
							<choice><value>~</value></choice>
							<choice><value>=</value></choice>
							<choice><value>&lt;</value></choice>
							<choice><value>&gt;</value></choice>
							<choice><value>@</value></choice>
							<choice><value>^</value></choice>
							<choice><value>|</value></choice>
							<choice><value>&amp;</value></choice>
							<choice><value>+</value></choice>
							<choice><value>-</value></choice>
							<choice><value>*</value></choice>
							<choice><value>/</value></choice>
							<choice><value>$</value></choice>
							<choice><value>%</value></choice>
						</or>
				</def>
			</bnf>
			<para>
				Последовательности &quot;символов операторов&quot; типа
				<keyword>&lt;=&gt;</keyword> или <keyword>!!</keyword> читаются как 
				один токен из классов <term>infix-char</term> или <term>prefix-char</term>.
				Такие символы разбраются как префиксные или инфиксные операторы внутри
				выражения или же ведут себя как идентификаторы.
			</para>
		</subsection>
		<subsection name="Ключевые слова" neednumber="0">
			<para>Следующие идентификаторы считаются ключевыми словами и не могут использоваться
			в другом качестве:</para>
			<listing>
				<![CDATA[	and         as          assert      asr         begin       class
      closed      constraint  do          done        downto      else
      end         exception   external    false       for         fun
      function    functor     if          in          include     inherit
      land        lazy        let         lor         lsl         lsr
      lxor        match       method      mod         module      mutable
      new         of          open        or          parser      private
      rec         sig         struct      then        to          true
      try         type        val         virtual     when        while
      with ]]></listing>
			<para>
				Следующие последовательности символов также считаются ключевыми словами:
			</para>
			<listing><![CDATA[    #     &     '     (     )     *     ,     ->    ?
    ??    .     ..    .(    .[    :     ::    :=    ;
    ;;    <-    =     [     [|    [<    {<    ]     |]
    >]    >}    _     `     {     |     }     ~]]></listing>
		</subsection>
		<subsection name="Неоднозначности" neednumber="0">
			<para>Лексические неоднозначности решаются по правилу "длиннейшего совпадения":
			если последовательность символов может быть разбита на два токена несколькими
			способами, используется тот способ, который дает наиболее длинный первый токен.
			</para>
		</subsection>
		<subsection name="Директивы номера строки" neednumber="0">
			<bnf>
				<term>linenum-directive</term>
				<def>
					<or multiline="1">
						<choice>
							<value>#</value>
							<repetitive count="1"><value>0...9</value></repetitive>
						</choice>
						<choice>
							<value>#</value>
							<repetitive count="1"><value>0...9</value></repetitive>
							<value>&quot;</value>
							<term>string-character</term>
							<value>&quot;</value>
						</choice>
					</or>
				</def>
			</bnf>
			<para>
				Препроцессоры, генерирующие исходный код на Caml, могут 
				помещать в свой вывод директивы номера строки, и тогда компилятор
				сможет добавлять к сообщениям об ошибках имена строк и имена файлов до
				предварительной обработки, а не после нее. Директива номера строки
				состит из <keyword>#</keyword> (знак диеза), за которым следует положительное
				целое число (номер строки) и, возможно, символьная строка (имя файла).
				Во время лексического анализа директивы номера строки считаются
				пробельными символами.
			</para>
		</subsection>
	</section>
	<section name="Типы данных">
		<para>В этом разделе описываются типы данных, обрабатываемых в
		Objective Caml.</para>
		<subsection name="Базовые типы" neednumber="1">
			<subsubsection name="Целые числа">
				<para>Целочисленными значениями считаются целые числа от <power pow="30">-2</power>
				до <power pow="30">2</power> - 1, то есть от -1073741824 до 1073741823. Реализация
				может поддерживать больший диапазон значений: в настоящее время
				на 64-разрядных платформах поддерживаются целые от <power pow="62">-2</power>
				до <power pow="62">2</power> - 1</para>
			</subsubsection>
			<subsubsection name="Числа с плавающей точкой">
				<para>Значениями с плавающей точкой считаются числа в одноименном представлении.
				Текущая реализация использует числа с плавающей точкой с двойной точностью согласно
				стандарту ISO 754 c мантиссой 53 бита и экспонентой от -1024 до 1024.
				</para> 
			</subsubsection>
			<subsubsection name="Символы">
				<para>Символы представлены как 8-битные целые числа от 0 до 255. Коды символов от 0 до
				127 интерпретируются по стандарту ASCII. Текущая реализация интерпретирует коды 
				символов от 127 до 255 по стандарту ISO 8859-1.</para>
			</subsubsection>
			<subsubsection name="Символьные строки">
				<para>Символьная строка - это конечная последовательность символов. Текущая реализация
				поддерживает строки, содержащие до <power pow="24">2</power> - 6 (то есть, 16777210)
				символов.</para>
			</subsubsection>
		</subsection>
	</section>
	</main-matters>
</chapter>
